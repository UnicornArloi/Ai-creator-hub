<!DOCTYPE html>
<html>
<head>
  <title>ğŸ§ª API Debug Test</title>
  <style>
    body { 
      font-family: 'SF Mono', Monaco, 'Courier New', monospace; 
      padding: 20px; 
      background: #0a0a0f; 
      color: #00ff88; 
      line-height: 1.6;
    }
    .success { color: #00ff88; }
    .error { color: #ff4444; }
    .warning { color: #ffaa00; }
    pre { 
      background: #1a1a2e; 
      padding: 15px; 
      border-radius: 8px; 
      overflow: auto;
      font-size: 12px;
      border: 1px solid #333;
    }
    .test-btn {
      padding: 15px 30px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }
    .test-fetch { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
    .test-axios { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }
    .test-cors { background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; }
    .test-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
    .test-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    #output { margin-top: 20px; }
    .status-badge {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }
    .status-pending { background: #ffaa00; color: #000; }
    .status-success { background: #00ff88; color: #000; }
    .status-error { background: #ff4444; color: #fff; }
  </style>
</head>
<body>
  <h1>ğŸ”§ API è°ƒè¯•æµ‹è¯•</h1>
  
  <div style="margin: 20px 0;">
    <button class="test-btn test-fetch" onclick="testFetch()">
      ğŸ“¡ æµ‹è¯• Fetch API (æ— ä»£ç†)
    </button>
    <button class="test-btn test-axios" onclick="testWithProxy()">
      ğŸ”„ æµ‹è¯•å¸¦ä»£ç†çš„è¯·æ±‚
    </button>
    <button class="test-btn test-cors" onclick="checkCORS()">
      ğŸ›¡ï¸ æ£€æŸ¥ CORS
    </button>
  </div>

  <div id="status"></div>
  <div id="output"></div>

  <script>
    const API_KEY = 'sk_-GORE__SpgDqJ4U__jLnVTRTtupCL1QmoZk4UPB2RLg'
    
    function log(msg, type = 'info') {
      const output = document.getElementById('output')
      const timestamp = new Date().toLocaleTimeString()
      const colorClass = type === 'error' ? 'error' : type === 'success' ? 'success' : 'warning'
      output.innerHTML += `<div class="${colorClass}">[${timestamp}] ${msg}</div><br>`
      console.log(`[${timestamp}] ${msg}`)
    }

    function updateStatus(text, type) {
      const status = document.getElementById('status')
      status.innerHTML = `<span class="status-badge status-${type}">${text}</span>`
    }

    async function testFetch() {
      log('ğŸ”„ å¼€å§‹æµ‹è¯• Fetch API...')
      updateStatus('æµ‹è¯•ä¸­...', 'pending')
      
      const startTime = Date.now()
      
      try {
        log('ğŸ“¤ å‘é€è¯·æ±‚åˆ° https://api.jikkou.ai/v1/images/generations')
        log(`ğŸ”‘ API Key: ${API_KEY.substring(0, 10)}...`)
        
        const response = await fetch('https://api.jikkou.ai/v1/images/generations', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${API_KEY}`,
            'Accept': 'application/json',
            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36'
          },
          body: JSON.stringify({
            model: 'gpt-image-1',
            prompt: 'cyberpunk city neon lights poster high quality',
            n: 1,
            size: 'auto'
          })
        })

        const duration = Date.now() - startTime
        log(`â±ï¸ å“åº”æ—¶é—´: ${duration}ms`)
        log(`ğŸ“Š HTTP çŠ¶æ€: ${response.status} ${response.statusText}`)
        log(`ğŸ“‹ å“åº”å¤´: ${JSON.stringify(Object.fromEntries(response.headers), null, 2)}`)

        const text = await response.text()
        log(`ğŸ“ å“åº”é•¿åº¦: ${text.length} å­—ç¬¦`)
        log(`ğŸ“„ å“åº”é¢„è§ˆ: ${text.substring(0, 500)}...`)

        try {
          const json = JSON.parse(text)
          log('âœ… JSON è§£ææˆåŠŸ!')
          log(`ğŸ” å®Œæ•´å“åº”: ${JSON.stringify(json, null, 2)}`)
          
          if (json.status === 'success' && json.data && json.data[0]) {
            const imgData = json.data[0]
            if (imgData.b64_json) {
              log(`ğŸ‰ æˆåŠŸ! æ”¶åˆ° base64 å›¾ç‰‡æ•°æ®, é•¿åº¦: ${imgData.b64_json.length}`)
              const img = new Image()
              img.src = `data:image/png;base64,${imgData.b64_json}`
              img.style.maxWidth = '300px'
              img.style.borderRadius = '8px'
              img.style.marginTop = '10px'
              output.appendChild(img)
              updateStatus('âœ… æˆåŠŸ!', 'success')
            }
          } else {
            log('âŒ å“åº”æ ¼å¼ä¸æ­£ç¡®', 'error')
            updateStatus('å“åº”æ ¼å¼é”™è¯¯', 'error')
          }
        } catch(e) {
          log(`âŒ JSON è§£æå¤±è´¥: ${e.message}`, 'error')
          log(`ğŸ“„ åŸå§‹å“åº”: ${text}`, 'error')
          updateStatus('JSONè§£æå¤±è´¥', 'error')
        }

      } catch (err) {
        const duration = Date.now() - startTime
        log(`âŒ è¯·æ±‚å¤±è´¥ (${duration}ms): ${err.message}`, 'error')
        log(`ğŸ“‹ é”™è¯¯è¯¦æƒ…: ${err.stack}`, 'error')
        
        if (err.name === 'TypeError' && err.message.includes('fetch')) {
          log('ğŸ’¡ æç¤º: æµè§ˆå™¨å¯èƒ½é˜»æ­¢äº†è·¨åŸŸè¯·æ±‚ (CORS)', 'error')
        }
        
        updateStatus('âŒ è¯·æ±‚å¤±è´¥', 'error')
      }
    }

    async function checkCORS() {
      log('ğŸ›¡ï¸ æ£€æŸ¥ CORS é…ç½®...')
      
      try {
        const response = await fetch('https://api.jikkou.ai/v1/images/generations', {
          method: 'OPTIONS',
          headers: {
            'Authorization': `Bearer ${API_KEY}`,
            'Content-Type': 'application/json'
          }
        })
        
        log(`CORS preflight çŠ¶æ€: ${response.status}`)
        log(`Access-Control-Allow-Origin: ${response.headers.get('Access-Control-Allow-Origin')}`)
        log(`Access-Control-Allow-Methods: ${response.headers.get('Access-Control-Allow-Methods')}`)
        log(`Access-Control-Allow-Headers: ${response.headers.get('Access-Control-Allow-Headers')}`)
        
      } catch (err) {
        log(`CORS æ£€æŸ¥å¤±è´¥: ${err.message}`, 'error')
      }
    }

    async function testWithProxy() {
      log('ğŸ”„ æµ‹è¯•ä½¿ç”¨ä»£ç†æœåŠ¡å™¨...')
      updateStatus('ä½¿ç”¨ä»£ç†æµ‹è¯•', 'pending')
      
      // ä½¿ç”¨ cors-anywhere ä»£ç†
      const proxyUrl = 'https://cors-anywhere.herokuapp.com/'
      const targetUrl = 'https://api.jikkou.ai/v1/images/generations'
      
      try {
        const response = await fetch(proxyUrl + targetUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${API_KEY}`,
            'X-Requested-With': 'XMLHttpRequest'
          },
          body: JSON.stringify({
            model: 'gpt-image-1',
            prompt: 'cyberpunk city neon lights',
            n: 1,
            size: 'auto'
          })
        })

        log(`ä»£ç†å“åº”çŠ¶æ€: ${response.status}`)
        const text = await response.text()
        log(`ä»£ç†å“åº”: ${text.substring(0, 300)}...`)
        
      } catch (err) {
        log(`ä»£ç†è¯·æ±‚å¤±è´¥: ${err.message}`, 'error')
        log('ğŸ’¡ æç¤º: å¦‚æœç›´æ¥è¯·æ±‚å¤±è´¥ä½†ä»£ç†æˆåŠŸ, è¯´æ˜æ˜¯ CORS é—®é¢˜', 'warning')
      }
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºæœ¬æµ‹è¯•
    log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆ, å‡†å¤‡æµ‹è¯•...')
    log('ğŸ’¡ ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•')
  </script>
</body>
</html>
