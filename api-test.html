<!DOCTYPE html>
<html>
<head>
  <title>API Test</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #050508; color: white; }
    button { padding: 10px 20px; margin: 10px; cursor: pointer; }
    pre { background: #1a1a2e; padding: 15px; border-radius: 8px; overflow: auto; }
    .success { color: #00ff88; }
    .error { color: #ff4444; }
  </style>
</head>
<body>
  <h1>ðŸ”§ jiekou.ai API Test</h1>
  <button onclick="testAPI()">Test API (no prompt)</button>
  <button onclick="testSimple()">Simple Test</button>
  <div id="output"></div>

  <script>
    const API_KEY = 'sk_-GORE__SpgDqJ4U__jLnVTRTtupCL1QmoZk4UPB2RLg'

    async function testSimple() {
      const output = document.getElementById('output')
      output.innerHTML = '<p>Testing simple request...</p>'
      
      try {
        const response = await fetch('https://api.jiekou.ai/v1/images/generations', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + API_KEY
          },
          body: JSON.stringify({
            model: 'gpt-image-1',
            prompt: 'test',
            n: 1,
            size: 'auto'
          })
        })
        
        const status = response.status
        const text = await response.text()
        
        output.innerHTML += `<p class="${status === 200 ? 'success' : 'error'}">Status: ${status}</p>`
        output.innerHTML += `<pre>${text}</pre>`
        
        try {
          const json = JSON.parse(text)
          output.innerHTML += '<pre>' + JSON.stringify(json, null, 2) + '</pre>'
        } catch(e) {
          output.innerHTML += '<p class="error">Failed to parse JSON</p>'
        }
      } catch (err) {
        output.innerHTML += `<p class="error">Fetch Error: ${err.message}</p>`
      }
    }

    async function testAPI() {
      const output = document.getElementById('output')
      output.innerHTML = '<p>Testing with full prompt...</p>'
      
      try {
        const response = await fetch('https://api.jikkou.ai/v1/images/generations', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + API_KEY
          },
          body: JSON.stringify({
            model: 'gpt-image-1',
            prompt: 'cyberpunk city, neon lights, poster, high quality',
            n: 1,
            size: 'auto'
          })
        })
        
        const status = response.status
        const text = await response.text()
        
        output.innerHTML += `<p class="${status === 200 ? 'success' : 'error'}">Status: ${status}</p>`
        output.innerHTML += `<pre>${text.substring(0, 500)}...</pre>`
        
        try {
          const json = JSON.parse(text)
          output.innerHTML += '<h3>Parsed JSON:</h3>'
          output.innerHTML += '<pre>' + JSON.stringify(json, null, 2) + '</pre>'
          
          if (json.data && json.data[0]) {
            const imgData = json.data[0]
            if (imgData.b64_json) {
              output.innerHTML += `<p class="success">âœ… b64_json found! Length: ${imgData.b64_json.length}</p>`
              output.innerHTML += `<img src="data:image/png;base64,${imgData.b64_json}" style="max-width: 300px; margin: 10px;">`
            }
            if (imgData.url) {
              output.innerHTML += `<p class="success">âœ… url found: ${imgData.url}</p>`
            }
          }
        } catch(e) {
          output.innerHTML += '<p class="error">Failed to parse JSON</p>'
        }
      } catch (err) {
        output.innerHTML += `<p class="error">Fetch Error: ${err.message}</p>`
      }
    }
  </script>
</body>
</html>
